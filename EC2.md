# EC2

## EC2概要

AWSが提供するIaaS（仮想マシン）

## 構成サービス

- EC2インスタンス（仮想マシン本体）
- EBS（ストレージ）
- ELB（ロードバランサー）
- ASG（自動スケーリング）
- ネットワーク系
  - Security Group

## インスタンスタイプ

一覧は以下を参照

https://instances.vantage.sh/

- General Purpose（M,T,Aタイプ）
  - 汎用的なタイプ。CPU、メモリ、ネットワークのバランスが取れている。
  - 用途
    - WebServer
    - コードリポジトリ
- Compute Optimized（Cタイプ）
  - 処理能力特化のタイプ。
  - 用途
    - バッチ処理
    - メディアのトランスコード
    - 高性能のWebServer
    - 機械学習
    - ゲームサーバー
- Memory Optimized（R,X,High Memory, Zタイプ）
  - メモリ最適化タイプ
  - 用途
    - RDBやInMemoryDBの高性能化
    - キャッシュストア
    - ビッグデータのリアルタイム処理
- Storage Optimized（I,G,Hタイプ）
  - ストレージ最適化タイプ
  - 用途
    - 高頻度のオンライントランザクション（OLTP）
    - RDB
    - NoSQL
    - RedisなどのCache for in-memory database
    - データウェアハウス
    - 分散ファイルシステム

## セキュリティグループ　概要

EC2インスタンスのファイアウォールとして機能し、トラフィックの出入りを制御する

- インバウンド、アウトバウンドそれぞれで設定可能
- ポート制御可能
- 1セキュリティグループを複数EC2インスタンスにアタッチすることが可能
- リージョン/VPC内にセキュリティグループを作成するため、リージョンやVPCをまたいでセキュリティグループは適用できない
- アベイラビリティゾーン間では同セキュリティグループを適用可能
- セキュリティグループから他のセキュリティグループを参照できる
  - 例えばセキュリティグループ作成時にセキュリティグループ１からのインバウンドを許可するようにすることが可能であり  
  その場合はセキュリティグループ１がアタッチされているEC2インスタンスからのアクセスを許可できる

## SSHでの接続

ターミナルからダウンロードしたkeypairを使用して接続する

```shell
ssh -i [keypair] ec2-user@[EC2のIPアドレス]
```

keypairに対してpermissonのエラーが発生することがあるが、keypairに対するpermissonが大きすぎるとエラーとなるようになっている。
以下のコマンドでpermissionを絞って接続する。

```shell
chmod 400 [keypair]
```

接続タイムタウトが発生する場合はセキュリティーグループの設定を見直す

その他の接続方法としてAWSコンソールからEC2InstanceConnectを使用する方法がある。   
コンソール（ブラウザ）から直接接続するため、keypairを管理する必要がなくなる。  
ただし、EC2InstanceConnectもssh接続を行うため、セキュリティグループでポート22は開けておく必要がある。

## ベストプラクティス

ターミナル内から他のAWSサービス（例えばIAMなど）にアクセスする場合、以下を実行してくださいというアラートが表示される。

```shell
$ aws iam list-users
Unable to locate credentials. You can configure credentials by running "aws configure".
```

この通りに設定し、続いてAccess Keyなどの情報を入力してはいけない。  
IAMから操作に対する権限を付与したRole(この場合は「IAMReadOnlyAccess」を付与したRole)を作成し  
EC2インスタンスにアタッチするのが正解。


## EC2の購入タイプについて

- OnDemand（オンデマンド）
  - 使用したいときに必要なだけ使用するタイプ
  - 短時間で中断のない稼働やアプリケーションの動作が予測不能な場合に推奨
- Reserved（リザーブドインスタンス）
  - 使用する期間があらかじめ決まっている際に使用するタイプ
  - Reserved
    - OnDemandと比較して72%の割引となる
    - いくつかの属性が固定される（インスタンスタイプ、リージョン、テナント、OS）
    - １年や３年契約にするとさらに割引
    - 前払いや一部前払いといった方法も可能
  - Convertible Reserved
    - インスタンスタイプ、インスタンスファミリー、OS、スコープ、テナントを変更でき  
    Reservedよりは柔軟で最大66%割引
- Saving Plan（節約プラン）
  - 月々でどれだけ使用するかをあらかじめ決めて予約しておくタイプ
    - 予約した量を超えて使用した場合は、そこからOnDemandによる課金となる
  - 最大72%割引となる
  - 長期的な利用に基づいて割引を受けられる
  - 特定のインスタンスファミリーやリージョンに固定となる
- Spot（スポットインスタンス）
  - 処理能力の高いインスタンスを入札で買う
    - ただし別に入札した額より高い金額を払う人がいれば停止させられる可能性がある
  - 現在価格が自身の価格を上回ったときには２分以内にインスタンス停止 or 終了させる必要がある
  - １時間〜６時間は中断なしでインスタンスを維持することも可能だが保証されるわけではない(Spot Block)
  - 最大90%割引
  - 用途
    - バッチジョブ
    - データ分析
    - 画像処理などの分散ワークロード
    - 開始時間と終了時間が柔軟なワークロードなどに使用する
  - クリティカルなジョブやデータベースに使用しないこと
- Dedicated Hosts（専用ホスト）
  - 専用のサーバー上にインスタンスを構築する
  - インスタンスの配置場所を変更することが可能
  - 用途
    - 規制やコンプライアンスを強く必要とする要件がある場合
    - 既存のサーバー向けソフトウェアライセンスを使用する場合（複数台で使用してはいけないライセンスなど）
    - 支払い方法
      - OnDemand
      - Reserved(1年 or 3年契約)
- Dedicated Instances（専用インスタンス）
  - 自分のハードウェア上で稼働するインスタンス
  - インスタンスの配置場所を変更することはできない

## Spot（スポットインスタンス）について

スポットインスタンスでは以下を定義し、スポットリクエストを送信する必要がある。

- 欲しいインスタンスの数
- 支払う予定の最大価格
- ローンチの仕様（AMIの定義）
- リクエストの有効期限

スポットリクエストは1回のみ、永続的のどちらでも可能。

永続的リクエストの場合
スポット価格に基づいてインスタンスが停止したり中断した場合、再度スポットリクエストが送信される。

スポットインスタンスを永続的に終了させたい場合は以下の手順を踏む必要がある。

1. スポットリクエストのキャンセル
2. 関連するスポットインスタンスの終了（AWSが勝手に終了させてはくれない）

先にスポットインスタンスを終了させてしまうと再度スポットリクエストが送信されてしまうので  
先にスポットリクエストをキャンセルする必要がある。

## Spot Fleet

スポットインスタンスとオンデマンドインスタンス（オプション）のセット  
以下を設定しておくことによってその中で一番安いスポットインスタンスを自動で複数起動できる。

- 最高価格
- 複数のインスタンスタイプ
- Availability Zone

## Elastic IP概要

EC2インスタンスは停止、起動を行うたびにPublic IPが変化する。  
停止、起動を行った場合でも同じPublic IPを使用したい場合は  
Elastic IPをEC2インスタンスに対して関連づける必要がある。

### 操作

1. Elastic IPを選択し、「Elastic IPを割り当てる」を選択
2. 情報を入力し、「割り当て」を選択
3. 取得したElastic IPを選択しアクションから「Elastic IPアドレスの関連付け」を選択
4. 関連づけたいEC2インスタンスを選択（※）

※ Elastic IPはEC2インスタンスのみではなく、ネットワークインターフェースに関連づけることも可能。  
関連付けを行っていない状態でElastic IPを取得した状態が続くと料金がかかるため  
Elastic IP取得後はなるべく早めに関連付けを行うこと。

## プレイスメントグループ

プレイスメントグループではEC2インスタンスをAWS内のどこに配置していくかを決定する。
プレイスメントグループでは以下の３つの戦略をとることが可能。

- Cluster
  - 単一アベイラビリティゾーンの単一ラックに複数EC2を配置する
    - グループに対して障害が発生すると全てが停止するため、リスクは高い
  - 用途
    - 低ネットワークレイテンシー、高スループットを必要とするアプリケーション
    - 高速で完了させる必要があるBigDataジョブ
- Spread
  - 複数アベイラビリティゾーンの完全に別のハードウェアにEC2インスタンスに配置する  
　　（1アベイラビリティゾーンに最大7インスタンスまで配置可能）
    - それぞれがハードウェアを共有しない
  - 用途
    - クリティカルなアプリケーション
- Partition
  - 複数アベイラビリティゾーンにパーティションを構成し、それぞれにEC2インスタンスを配置する
    - 1アベイラビリティゾーンに7つまでのパーティションを持つことが可能
    - それぞれのパーティションでラックを共有しないため、単一ラックのハードウェア障害は他ラックに影響しない
    - 1パーティションにEC2インスタンスを100台までスケールさせることができる
  - 用途
    - Hadoop
    - Cassandra
    - Kafka

### 操作

1. EC2のコンソールから「Network & Security」内にある「プレイスメントグループ」を選択
2. 「プレイスメントグループを作成」を選択
3. 名前とプレイスメント戦略を選択して作成
4. EC2の「インスタンスを起動」から「高度な詳細」を選択
5. 「高度な詳細」から作成した「プレイスメントグループ」を選択

## Elastic Network Interface概要

仮想ネットワークカードであり、対象のAWSサービス（EC2など）にインターネットアクセスを提供する。

- 1つのプライマリPrivate IPを保持する
- 1つ以上のセカンダリPrivate IPを保持することが可能
- 1つのPrivate IPごとに1つのElastic IPを保持することが可能
- 1つのPublic IPを保持する
- 1つ以上のセキュリティグループをアタッチすることが可能
- MACアドレスを付与することが可能
- 独立して作成可能、ENIを別のEC2インスタンスに付与するなどでフェイルオーバーさせるといった使い方が可能
- アベイラビリティゾーンを超えてアタッチすることはできない

### 操作

1. EC2のコンソールから「Network & Security」内にある「ネットワークインターフェース」を選択
2. 「ネットワークインターフェースの作成」を選択
3. 情報を入力して「ネットワークインターフェイスの作成」
4. アクションから「アタッチ」を使用してEC2にアタッチする

###　フェイルオーバーさせる

1. アクションから「デタッチ」を使用してEC2からENIをデタッチする
2. 別のEC2にデタッチしたENIをアタッチする

これによってPrivate IPでアクセスしていたアプリの向き先を別のEC2に向けることができる。

### ENIが関連づけられたEC2を削除した場合の挙動

ENIが関連づけられたEC2を削除した場合はEC2と同時に作成されたENIは同時に削除される。  
つまりEC2と同時に作成されたENIには終了時に削除するフラグが付与されている。  
単独で作成したENIは削除されずにそのまま残る。

## EC2 ハイバネーション

通常EC2が停止するとOSも停止となるため、メモリ上にあったデータは消失する。  
しかしEC2 ハイバネーションを使用することによってメモリ上のデータ消失を防ぎつつ、EC2を停止することができる。
具体的には以下のようになる。

1. EC2停止処理開始
2. EC2のメモリ上にあったデータをEBSに待避
3. EC2の停止完了

起動時

1. EC2起動処理開始
2. EBS上のデータをEC2から読み込み
3. 停止前の状態でEC2起動

### 用途

- 長時間実行されるプロセスが必要な場合
- メモリの状態を保存しておきたい場合
- EC2の高速起動や再起動を行いたい場合（アプリケーション初期化に時間がかかる等）

### 操作

EC2インスタンス起動時のメニューから以下の操作を行う。

1. ストレージから「アドバンスト」を選択し、ルートボリュームの「暗号化済み」にて「暗号化済み」を選択（※）
2. KMSキーにてデフォルトの「aws/ebs」を選択
3. 「高度な詳細」から「停止 - 休止動作」から「有効化」を選択する

※ EC2ハイバネーションを行う場合はEC2の終了時にRAMの内容がルートEBSに書き込まれるため  
ルートEBSは暗号化されてい必要がある。

## EBS(Elastic Block Store) 概要

- インスタンスに接続できるネットワークストレージ（要はディスク）
- データの永続化ができる
- アベイラビリティゾーンを超えて利用することはできない
  - ただし、スナップショットについてはアベイラビリティゾーンを超えて利用できる
- 事前に以下をプロビジョニングする必要がある
  - 容量（GBs）
  - IOPS（1秒あたりのI/O操作数）
- プロビジョニングした性能により、料金が決定する
- 時間経過と共に、性能を向上させることが可能（容量を増やす、パフォーマンスを上げる）
- EC2インスタンスの終了と共に削除するオプションを選択することができる
  - デフォルトではルートボリュームは削除される（その他のボリュームは削除されない）

### EBS作成手順

Elastic Block Storeから以下の操作を行う。

1. ボリュームの作成
2. 情報を入力して「ボリュームの作成」を選択
   1. 前述の通りアベイラビリティゾーンは対象のEC2インスタンスと同じものを選択する必要がある  
   （別のアベイラビリティゾーンを選択するとEC2インスタンスにアタッチできない）
3. 一覧から対象のEBSを選択し、「アクション」からボリュームのアタッチ
4. アタッチするEC2インスタンスを選択する

### スナップショット

EBSはスナップショット（つまりその時点でのバックアップ）を取得することができる。

- EC2インスタンスからデタッチすることなく取得することが可能
- スナップショットは別アベイラビリティゾーンやリージョンをまたいで使用することが可能
- スナップショットは最大75%安くなるアーカイブ層に移動させることが可能
  - アーカイブ化は24時間-72時間以内に完了する（即時完了するわけではない）
- EBS専用のゴミ箱を利用することが可能（誤って削除しても復元できる）
  - ゴミ箱の保存期間を設定することが可能（1日-1年）
- 高速スナップショット復元（FSR）をサポートしている
  - プレウォーミングが不要となる
    - 通常スナップショットから復元されたEBSはアクセス時のレイテンシが通常より大きい状態となっており、IOパフォーマンスが低い。フルパフォーマンスを発揮するためには一定時間が必要だった  
    - FSRではスナップショットの初回起動時にそういったパフォーマンス低下がない
    - 料金は高い

### 操作（スナップショットの取得）

Elastic Block Storeから以下の操作を行う。

1. 「アクション」から「スナップショットの作成」を選択
2. 情報を入力して「スナップショットの作成」を選択
3. 「スナップショット」の一覧に取得したスナップショットが表示される
4. 「アクション」から「スナップショットをコピー」を選択
5. ここで必要に応じて別リージョンにスナップショットをコピーすることが可能

### 操作（スナップショットの復元）

Elastic Block Storeから以下の操作を行う。

1. スナップショットを選択し、「アクション」から「スナップショットからボリュームを作成」を選択
2. ここで必要に応じて別のアベイラビリティゾーンに変更して復元することが可能
3. 「ボリューム」の一覧に復元したボリュームが表示される

### 操作（ゴミ箱のルールを作成）

Elastic Block Storeから以下の操作を行う。

1. スナップショットをの「ゴミ箱」を選択
2. 「保持ルールを作成」を選択
3. 情報を入力して「保持ルールを作成」を選択

### 操作（スナップショットの削除-復元）

Elastic Block Storeから以下の操作を行う。

1. スナップショットを選択して「アクション」から「スナップショットの削除」を選択
2. 「ゴミ箱」を見てみると削除されたスナップショットが入っていることを確認できる
3. 対象のスナップショットを選択し、「復旧」を選択すると「スナップショット」の一覧に再度表示される

## AMI(Amazon Machine Image) 概要

EC2インスタンスのカスタマイズされた状態を保存できる。
EC2インスタンス起動後に変更した設定やインストールしたソフトウェアをそのままの状態でイメージとして保存可能。
インストールしたいソフトウェアが全て揃った状態で起動できるため、起動時間を短縮可能。
特定のリージョン向けに作成することもでき、リージョンをまたいでコピーすることも可能。

### AMI作成-起動手順 概要

1. EC2インスタンスを起動する
2. 設定変更などを行う
3. EC2インスタンスを停止する
4. AMIをビルドする（この過程でEBSのスナップショットも同時に取得される）
5. ビルドしたAMIを使用してEC2インスタンスを起動する

### AMI作成-起動手順

1. EC2インスタンスを起動する
2. 作成したEC2インスタンスを選択し、「イメージとテンプレート」から「イメージを作成」を選択
3. 情報を入力し、「イメージを作成」を選択
4. イメージから「AMI」を選択
5. 作成したAMIを選択し、「AMIからインスタンスを起動」を選択
6. マシンイメージ選択時に「自分のAMI」から作成したAMIを選択し、起動

## EC2インスタンスストア

EBSはネットワークドライブであり、パフォーマンスにある程度の制限がある。  
より良いパフォーマンスを求める場合にはEC2インスタンスストアを利用できる。
EC2インスタンスストアは以下の特徴がある。

- 物理サーバーに直接接続されているハードドライブである（ネットワークドライブではない）
- EBSより高いI/Oパフォーマンスが必要な場合に使用する
- 接続されているEC2インスタンスを停止するとストレージの内容は全消える（つまり一時ストレージという扱い）
- 長期的な保存には向かない（長期保存するデータ停止前にEBS、S3、EFSなどにコピーする）
- 用途
  - バッファ領域
  - キャッシュ領域
  - 一時的なコンテンツ
- インスタンスサイズによってReadとWriteのIOPSが決められている

## EBSボリュームタイプ

- gp2(SSD)
- gp3(SSD)
  - 汎用SSDボリューム
  - 価格とパフォーマンスのバランスが良い
  - 様々なワークロードに対応している
- io1(SSD)
- io2 Block Express(SSD)
  - 最高パフォーマンスのSSDボリューム
  - ミッションクリティカルな低遅延のために使用される
  - 高スループットのワークロードに対応している
- st1(HDD)
  - 低コストのHDDボリューム
  - 頻繁なアクセスに向いている
  - スループット集中型のワークロードに向いている
- sc1(HDD)
  - 最も低コストなHDDボリューム
  - アクセス頻度の低いワークロードに向いている

### どのようにEBSボリュームを選択するか

- サイズ
- スループット
- IOPS
- SSDボリューム（gp2,gp3,io1,io2 Block Express）のみがブートボリュームとして選択可能

### EBSボリュームタイプ詳細(gp2,gp3)

- gp2
  - 低遅延のコスト効率の高いストレージ
  - 用途
    - ブートボリュームとして使用可能
    - バーチャルデスクトップ
    - 開発
    - テスト環境
  - サイズは1GB-16TBまでサポート
  - 最大3000IOPSまでバーストできるSmall gp2ボリュームもある
  - ボリュームサイズとIOPSがリンクしており、ボリュームサイズによって最大16000IOPSまで性能を向上させることが可能(3段階あり、5334GBで最大IOPSに達する)
- gp3
  - gp2とは異なり、個別にIOPSを設定可能
  - ベースとして3000IOPS
    - 最大16000IOPSまで性能を向上させることが可能
  - ベースとして毎秒125MBのスループット
    - 最大で毎秒1000MBまで性能を向上させることが可能

### EBSボリュームタイプ詳細(io1,io2 Block Express)

Provisioned IOPSと呼ばれており、性能が保証されている。
特徴は以下の通り。

- 一定のIOPSを保証する必要があるクリティカルなビジネスアプリケーション
- 大量のIOPSを使用するアプリケーション(16000IOPS以上)
- 主に高性能なデータベースのディスクとして使用
- マルチアタッチ（同じアベイラビリティゾーン内にある複数のEC2インスタンスにアタッチ）が可能
- io1
  - 4GB-16TB
  - 最大64000IOPS（Nitroインスタンスを使用した場合）、他は32000IOPS
  - ストレージサイズとは関係なく値を設定することが可能
- io2 Block Express
  - 4GB-64TB
  - 最大256000IOPS、IOPS:GiBの比率は1000:1

### EBSボリュームタイプ詳細(st1,sc1)

HDDのボリューム。
特徴は以下の通り。

- ブートボリュームとしては利用不可
- 125GB-16TB
- st1
  - スループットが最適化されている
  - Big Data
  - データウェアハウス
  - ログ処理
  - 最大スループットは毎秒500MB
  - 最大IOPSは500IOPS
- sc1
  - コールドHDD（アーカイブデータ用）
  - アクセス頻度が低いデータ用
  - できるだけコストを抑えたい場合
  - 最大スループットは毎秒250MB
  - 最大IOPSは250IOPS

## EBSマルチアタッチ

EBSを同じアベイラビリティゾーン内にある複数のEC2インスタンスにアタッチする。
io1,io2 Block Expressのみ可能。
複数のEC2インスタンスから同時にハイパフォーマンスボリュームへと読み込み、書き込みが可能。
以下で使用される。

- クラスター化されたLinuxアプリケーション（Teradata）
- アプリケーションで1ストレージへの同時書き込みを操作する必要がある場合
- 一度に最大16のEC2インスタンスまでアタッチ可能
- クラスター対応のファイルシステムを利用する必要がある

## EBS Encryption

EBS内のデータを暗号化する。
特徴は以下の通り。

- インスタンス感で転送される全てのデータも暗号化される
- 全てのスナップショットも暗号化される
- スナップショットから復元されたボリュームも暗号化される
- 暗号化は透過的に処理される（全てEC22とEBSによってバックグランドで処理される）
- レイテンシへの影響は最小限
- KMS(AWS Key Management System - AWS-256)のキーを使用する

### 暗号化されていないスナップショットを暗号化する手順

- 暗号化されていないボリュームのスナップショットを取得する
- スナップショットのコピー機能を使用し、コピーする際に暗号化を実施する
- 暗号化したスナップショットを使用して新しいEBSボリュームを作成する
- 元のインスタンスに暗号化したボリュームをアタッチする

1. 「Elastic Block Store」からボリュームの作成を選択
2. 「このボリュームを暗号化する」のチェックを外しておく
3. 「ボリュームの作成」を選択
4. 作成したボリュームを選択して「スナップショットの作成」を選択
5. 「スナップショットの作成」を選択
6. 作成されたスナップショットを選択し、「スナップショットをコピー」を選択
7. 「このスナップショットを暗号化」をチェックし、「スナップショットをコピー」を選択
8. 暗号化されたスナップショットを選択し、「スナップショットからボリュームを作成」を選択
9. 「ボリュームの作成」を選択

## Amazon EFS(Elastic File System)

AWSが提供するネットワークファイルシステム。
特徴は以下の通り。

- 多くのEC2インスタンスにマウント可能
- EFSは異なるアベイラビリティゾーンに存在する
  - 可用性が高い
  - AZ1のインスタンス、AZ2のインスタンス、AZ3のインスタンスそれぞれに同時マウント可能
- 高価(EBSの3倍くらい)
- データのGBごとに従量課金
- 事前にプロビジョニングが不要（自動拡張）
- セキュリティグループを適用できる
- 用途
  - コンテンツ管理
  - Webサービス
  - データ共有
  - WordPress
- 内部プロトコルはNFSを使用する
- LinuxベースのAMIのみ互換性あり（Windowsとは互換性無し）
- KMSを使用して暗号化可能
- POSIXシステムを使用しており、標準ファイルAPIを備えている

### Amazon EFSのパフォーマンス

パフォーマンスについてオプションを設定することが可能。

- NFSクライアント1000ごと、スループット10GBごとに自動拡張
- モード
  - General Purpose
    - デフォルトのパフォーマンスモード
    - レイテンシーに敏感なユースケースに使用される
      - Web Server
      - CMS
  - Max I/O
    - レイテンシーが高いが、並行処理に強い
      - big data
      - media processing
- スループットの設定（オプション）
  - バースト
    - 1TBごとに50MB+100MBのバーストを行って処理させる
  - プロビジョニング
    - ストレージのサイズに関係なくスループットを設定可能
  - Elastic
    - ワークロードに応じて自動でスケールさせる

### Amazon EFSのストレージクラス

ストレージについてオプションを設定することが可能。

- Storage Tiers
  - N日後にファイルを移動させることが可能
    - Standard
      - 頻繁にアクセスされるファイル用
    - Infrequent access(EFS-IA)
      - 低頻度アクセスファイル用
        - ファイルの保持はStandardより安い
        - ファイル取得時に料金がかかる
      - ライフサイクルポリシーを有効化する必要がある
- 可用性
  - Standard
    - マルチAZに設定可能
  - One Zone
    - 1つのアベイラビリティゾーンにする（開発用など）
    - バックアップはデフォルトで有効となっている（EFS One Zone-IAに配置される）

例）

1. 事前にライフサイクルポリシーを設定しておく
2. Standard領域にファイルを配置
3. Standard領域のうち、60日間アクセスのないファイルがあった場合EFS-IAにファイルが移動される

### Amazon EFSの操作(EFS作成-EC2起動-EC2にEFSをマウント)

1. コンソールからElastic File Systemにアクセス
2. 「ファイルシステムの作成」を選択
3. 「カスタマイズ」を選択
4. 情報を入力して「作成」
5. EC2のインスタンスを起動
6. サブネットを選択
7. ストレージを設定の項目にてファイルシステムの「編集」を選択
8. 「EFS」を選択
9. 「共有ファイルシステムを追加」を選択し、作成したEFSを選択